<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>線上課程平台</title>
    <style>
        body {
            font-family: Arial, sans-serif;
        }
        nav {
            background-color: #f8f8f8;
            padding: 10px;
        }
        nav a {
            margin: 0 15px;
            text-decoration: none;
            color: #333;
        }
        nav a:hover {
            text-decoration: underline;
        }
        .content {
            display: none;
        }
        .content.active {
            display: block;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        table, th, td {
            border: 1px solid black;
        }
        th, td {
            padding: 8px;
            text-align: left;
        }
    </style>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
        const teacherName = localStorage.getItem('teacherName');
        if (teacherName) {
            document.getElementById('welcomeMessage').textContent = `歡迎${teacherName}老師登入系統`;
        }
        });

        function showContent(id) {
            var contents = document.querySelectorAll('.content');
            contents.forEach(function(content) {
                content.classList.remove('active');
            });
            document.getElementById(id).classList.add('active');
        }

        function addCourse() {
            document.getElementById('courseForm').style.display = 'block';
            document.getElementById('editForm').style.display = 'none';
        }

        function submitCourse() {
            let data = {
                "course_id": document.getElementById("course_id").value,
                "course_name": document.getElementById("course_name").value,
                "description": document.getElementById("description").value,
                "teacher_name": document.getElementById("teacher_name").value,
            };

            axios.post("../server/index.php?action=CourseInsert", Qs.stringify(data))
                .then(res => {
                    let response = res['data'];
                    if (response['status'] === 200) {
                        let courseTable = document.querySelector("#courseTable tbody");
                        let newRow = `
                            <tr>
                                <td>${data.course_id}</td>
                                <td>${data.course_name}</td>
                                <td>${data.description}</td>
                                <td>${data.teacher_name}</td>
                                <td>
                                    <button onclick="editCourse('${data.course_id}')">修改</button>
                                    <button onclick="deleteCourse('${data.course_id}')">刪除</button>
                                </td>
                            </tr>
                        `;
                        courseTable.innerHTML += newRow;

                        // 清空表單
                        document.getElementById("course_id").value = '';
                        document.getElementById("course_name").value = '';
                        document.getElementById("description").value = '';
                        document.getElementById("teacher_name").value = '';

                        // 隱藏表單
                        document.getElementById('courseForm').style.display = 'none';
                    } else {
                        alert(response['message']);
                    }
                })
                .catch(err => {
                    console.error(err);
                    alert("新增課程失敗");
                });
        }

        function loadCourses() {
            axios.post("../server/index.php?action=CourseSelect")
                .then(res => {
                    let response = res['data'];
                    if (response['status'] === 200) {
                        let courses = response['result'];
                        let courseTable = document.querySelector("#courseTable tbody");
                        courseTable.innerHTML = ''; // 清空表格
                        courses.forEach(course => {
                            let newRow = `
                                <tr>
                                    <td>${course.course_id}</td>
                                    <td>${course.course_name}</td>
                                    <td>${course.description}</td>
                                    <td>${course.teacher_name}</td>
                                    <td>
                                        <button onclick="editCourse('${course.course_id}')">修改</button>
                                        <button onclick="deleteCourse('${course.course_id}')">刪除</button>
                                    </td>
                                </tr>
                            `;
                            courseTable.innerHTML += newRow;
                        });
                    } else {
                        alert(response['message']);
                    }
                })
                .catch(err => {
                    console.error(err);
                    alert("載入課程失敗");
                });
        }

        function deleteCourse(course_id) {
            axios.post("../server/index.php?action=CourseDelete", Qs.stringify({ course_id }))
                .then(res => {
                    let response = res['data'];
                    if (response['status'] === 200) {
                        loadCourses();
                    } else {
                        alert(response['message']);
                    }
                })
                .catch(err => {
                    console.error(err);
                    alert("刪除課程失敗");
                });
        }

        function editCourse(course_id) {
            axios.post("../server/index.php?action=CourseSelect", Qs.stringify({ course_id }))
                .then(res => {
                    let response = res['data'];
                    if (response['status'] === 200) {
                        let course = response['result'][0];
                        document.getElementById('edit_course_id').value = course.course_id;
                        document.getElementById('edit_course_name').value = course.course_name;
                        document.getElementById('edit_description').value = course.description;
                        document.getElementById('edit_teacher_name').value = course.teacher_name;
                        document.getElementById('editForm').style.display = 'block';
                        document.getElementById('courseForm').style.display = 'none';
                    } else {
                        alert(response['message']);
                    }
                })
                .catch(err => {
                    console.error(err);
                    alert("載入課程失敗");
                });
        }

        function updateCourse() {
            let data = {
                "course_id": document.getElementById("edit_course_id").value,
                "course_name": document.getElementById("edit_course_name").value,
                "description": document.getElementById("edit_description").value,
                "teacher_name": document.getElementById("edit_teacher_name").value,
            };

            axios.post("../server/index.php?action=CourseUpdate", Qs.stringify(data))
                .then(res => {
                    let response = res['data'];
                    if (response['status'] === 200) {
                        loadCourses();
                        document.getElementById('editForm').style.display = 'none';
                    } else {
                        alert(response['message']);
                    }
                })
                .catch(err => {
                    console.error(err);
                    alert("更新課程失敗");
                });
        }

        window.onload = function() {
            loadCourses();
            let teacherName = localStorage.getItem('teacherName');
            if (teacherName) {
                document.getElementById('welcomeMessage').innerText = `歡迎 ${teacherName} 老師登入系統`;
            }
        }
    </script>
</head>
<body>
    <nav>
        <a href="#home" onclick="showContent('home')">首頁</a>
        <a href="#courses" onclick="showContent('courses')">您的課程</a>
    </nav>
    <div id="home" class="content active">
        <h1 id="welcomeMessage">歡迎{teacher_name}登入</h1>
        <p>這是首頁的內容。</p>
    </div>
    <div id="courses" class="content">
        <h1>您的課程</h1>
        <p>這是老師目前所開設的所有課程畫面。</p>
        <button onclick="addCourse()">新增課程</button>
        <div id="courseForm" style="display:none;">
            <h2>新增課程</h2>
            <label for="course_id">課程編號：</label>
            <input type="text" id="course_id"><br><br>
            <label for="course_name">課程名稱：</label>
            <input type="text" id="course_name"><br><br>
            <label for="description">課程描述：</label>
            <textarea id="description" style="resize: both;"></textarea><br><br>
            <label for="teacher_name">教師姓名：</label>
            <input type="text" id="teacher_name"><br>
            <button onclick="submitCourse()">提交</button>
        </div>
        <div id="editForm" style="display:none;">
            <h2>修改課程</h2>
            <label for="edit_course_id">課程編號：</label>
            <input type="text" id="edit_course_id" disabled><br><br>
            <label for="edit_course_name">課程名稱：</label>
            <input type="text" id="edit_course_name"><br><br>
            <label for="edit_description">課程描述：</label>
            <textarea id="edit_description" style="resize: both;"></textarea><br><br>
            <label for="edit_teacher_name">教師姓名：</label>
            <input type="text" id="edit_teacher_name"><br>
            <button onclick="updateCourse()">提交</button>
        </div>
        <table id="courseTable">
            <thead>
                <tr>
                    <th>課程編號</th>
                    <th>課程名稱</th>
                    <th>課程描述</th>
                    <th>教師姓名</th>
                    <th>操作</th>
                </tr>
            </thead>
            <tbody>
                <!--  -->
            </tbody>
        </table>
        
    </div>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/qs/dist/qs.js"></script>
</body>
</html>